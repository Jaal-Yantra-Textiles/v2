/* JYT Analytics v1.0.0 | Privacy-focused tracking | https://jaalyantra.in */
!function(){"use strict";const t=document.currentScript,e=t.getAttribute("data-website-id"),n=`${t.getAttribute("data-api-url")||"https://v3.jaalyantra.com"}/web/analytics/track`;if(!e)return void console.warn("[Analytics] Missing data-website-id attribute");function o(){const t="jyt_visitor_id";let e=localStorage.getItem(t);return e||(e="visitor_"+Math.random().toString(36).substring(2)+Date.now().toString(36),localStorage.setItem(t,e)),e}function i(){const t="jyt_session_id",e="jyt_session_timestamp",n=Date.now();n-parseInt(sessionStorage.getItem(e)||"0")>18e5&&sessionStorage.removeItem(t);let o=sessionStorage.getItem(t);return o||(o="session_"+Math.random().toString(36).substring(2)+Date.now().toString(36),sessionStorage.setItem(t,o)),sessionStorage.setItem(e,n.toString()),o}function a(){const t=window.location.search;return t?t.substring(1):void 0}function s(){const t=document.title.toLowerCase(),e=document.body?document.body.textContent.toLowerCase():"";return t.includes("404")||t.includes("not found")||e.includes("page not found")||e.includes("404 error")}function r(){const t={website_id:e,event_type:"pageview",pathname:window.location.pathname,referrer:document.referrer||void 0,visitor_id:o(),session_id:i(),query_string:a(),is_404:s()},n=function(){const t=new URLSearchParams(window.location.search),e={};return["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(function(n){const o=t.get(n);o&&(e[n]=o)}),Object.keys(e).length>0?e:void 0}();n&&Object.assign(t,n),l(t)}function c(t,n){l({website_id:e,event_type:"custom_event",event_name:t,pathname:window.location.pathname,visitor_id:o(),session_id:i(),metadata:n||void 0})}function l(t){if(navigator.sendBeacon){const e=new Blob([JSON.stringify(t)],{type:"application/json"});navigator.sendBeacon(n,e)}else fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),keepalive:!0}).catch(function(t){console&&console.error&&console.error("[Analytics] Failed to send event:",t)})}r();let d=window.location.pathname;function u(){const t=window.location.pathname;t!==d&&(d=t,r())}const m=history.pushState,g=history.replaceState;history.pushState=function(){m.apply(this,arguments),u()},history.replaceState=function(){g.apply(this,arguments),u()},window.addEventListener("popstate",u);let p=null;function w(){p&&clearInterval(p),p=setInterval(()=>{"visible"===document.visibilityState&&c("heartbeat",{page:window.location.pathname,active:!0})},3e4)}function v(){p&&(clearInterval(p),p=null)}document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState?w():v()}),w(),window.addEventListener("beforeunload",v),window.jytAnalytics={track:c,trackPageview:r,startHeartbeat:w,stopHeartbeat:v},console&&console.log&&(console.log("[Analytics] Initialized for website:",e),console.log("[Analytics] Heartbeat enabled (30s interval)"))}();